# Bookora Backend - Log Rotation Configuration
# 
# This file configures log rotation for all Bookora application logs
# to prevent disk space issues and maintain system performance.
#
# Installation:
#   sudo cp logrotate.conf /etc/logrotate.d/bookora
#   sudo chmod 644 /etc/logrotate.d/bookora
#
# Manual test:
#   sudo logrotate -f /etc/logrotate.d/bookora
#
# Author: Bookora Team

# API logs
/var/www/bookora/logs/api.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        # Reload Bookora API if running
        if [ -f /var/run/bookora_api.pid ]; then
            kill -USR1 `cat /var/run/bookora_api.pid`
        fi
    endscript
}

# Celery worker logs
/var/www/bookora/logs/celery_worker.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        # Reload Celery worker if running
        if [ -f /var/run/bookora_celery_worker.pid ]; then
            kill -HUP `cat /var/run/bookora_celery_worker.pid`
        fi
    endscript
}

# Celery beat scheduler logs
/var/www/bookora/logs/celery_beat.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
}

# Flower monitoring logs
/var/www/bookora/logs/flower.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
}

# Backup logs
/var/www/bookora/logs/backup_*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
}

# Deployment logs
/var/www/bookora/logs/deploy_*.log {
    weekly
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
}

# Monitoring logs
/var/www/bookora/logs/monitor*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
}

# Redis logs (if managed locally)
/var/log/redis/redis-server.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 redis redis
    postrotate
        /usr/bin/redis-cli BGSAVE
    endscript
}

# Nginx access logs (if using nginx)
/var/log/nginx/bookora_access.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

# Nginx error logs
/var/log/nginx/bookora_error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

